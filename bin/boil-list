#!/usr/bin/env node

const { Command } = require('commander');
const { readdirSync } = require('fs');
const { isDirectorySync } = require('path-type');
const { join } = require('path');
const templateDirectory = require('../src/util/template-directory');
const { loadConfig } = require('../src/util/config');

const program = new Command();
program
  .usage('[options]')
  .option(
    '-c, --config <path>',
    'custom config file or directory to look for a config file'
  )
  .parse(process.argv);

// Load config
const { config, filepath: configPath } = loadConfig(program.config);
const templateDir = templateDirectory(config.templateDirectory, configPath);
if (!templateDir) {
  console.error(`Template directory specified in config not found!`);
  process.exit(1);
}

// Find all directories in the template directory
const templates = readdirSync(templateDir).filter((path) =>
  isDirectorySync(join(templateDir, path))
);

if (templates.length > 0) {
  const templateList = templates.map((t) => '- ' + t).join('\n');
  console.info(
    `Found ${templates.length} templates in ${templateDir}:\n${templateList}`
  );
} else {
  console.info(`No templates exist in ${templateDir}!`);
}
