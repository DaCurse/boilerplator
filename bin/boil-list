#!/usr/bin/env node

const { Command } = require('commander');
const { readdirSync } = require('fs');
const { isDirectorySync } = require('path-type');
const { join } = require('path');
const templateDirectory = require('../src/util/template-directory');
const { loadConfig } = require('../src/util/config');
const commandWrapper = require('../src/errors/command-wrapper');

const program = new Command();
program
  .usage('[options]')
  .action((opts) => commandWrapper(run, opts))
  .parse(process.argv);

function run(program) {
  const { config, filepath: configPath } = loadConfig(program.config);
  const templateDir = templateDirectory(config.templateDirectory, configPath);

  // Find all directories in the template directory
  const templates = readdirSync(templateDir).filter((path) =>
    isDirectorySync(join(templateDir, path))
  );

  if (templates.length > 0) {
    const templateList = templates.map((t) => '- ' + t).join('\n');
    console.info(
      `Found ${templates.length} templates in ${templateDir}:\n${templateList}`
    );
  } else {
    console.info(`No templates exist in ${templateDir}!`);
  }
}
